<!doctype html>
<html lang="fr">
<head>
    <meta charset="utf-8">
    <title>Scraper de page web</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">

</head>
<body>
    <div class="page-wrapper">
        <div class="card">
            <h1>Mini app de scraping üï∏Ô∏è</h1>
            <p class="subtitle">
                Indique l‚ÄôURL de la page que tu veux scraper (article, blog, page Wikip√©dia, etc.).
            </p>

            <form method="POST">
                <label for="url">URL de la page :</label>
                <div class="url-group">
                    <input
                        type="text"
                        id="url"
                        name="url"
                        value="{{ url_saisie }}"
                        placeholder="https://example.com/article"
                        autocomplete="off"
                    >
                    <button type="submit" class="btn-primary">
                        <span class="icon">üîç</span>
                        <span>Scraper</span>
                    </button>
                </div>
            </form>

            {% if erreur %}
                <div class="erreur">{{ erreur }}</div>
            {% endif %}

            {% if texte %}
                <div class="result-section">
                    <div class="result-header">
                        <h2>Texte scrap√©</h2>
                        <div>
                            <button type="button" class="btn-ghost" onclick="copierTexte()">
                                <span class="icon">üìã</span>
                                <span>Copier tout le texte</span>
                            </button>
                            <div id="copie-ok" class="notice">
                                ‚úÖ Texte copi√© dans le presse-papiers
                            </div>
                        </div>
                    </div>
                    <textarea id="resultat" readonly>{{ texte }}</textarea>
                </div>
            {% endif %}
        </div>
    </div>

    <script>
        function copierTexte() {
            const textarea = document.getElementById("resultat");
            const notice = document.getElementById("copie-ok");
            if (!textarea) return;

            const contenu = textarea.value;

            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(contenu).then(function () {
                    if (notice) {
                        notice.style.display = "block";
                        setTimeout(() => {
                            notice.style.display = "none";
                        }, 2000);
                    }
                }).catch(function () {
                    // Fallback si le copier moderne √©choue
                    fallbackCopy(textarea, notice);
                });
            } else {
                // Fallback pour vieux navigateurs
                fallbackCopy(textarea, notice);
            }
        }

        function fallbackCopy(textarea, notice) {
            textarea.focus();
            textarea.select();
            try {
                document.execCommand("copy");
                if (notice) {
                    notice.style.display = "block";
                    setTimeout(() => {
                        notice.style.display = "none";
                    }, 2000);
                }
            } catch (err) {
                alert("Impossible de copier automatiquement. Copie manuelle : Ctrl+C / Cmd+C.");
            }
            window.getSelection().removeAllRanges();
        }
    </script>
</body>
</html>
